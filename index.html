<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente Estat√≠stico</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary-dark) 30%, #e0e7ff 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e0e0e0;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .main-panel {
            padding: 30px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: 400;
            cursor: pointer;
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            box-shadow: 0 8px 20px rgba(30, 41, 59, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-download {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            margin-right: 10px;
        }

        .btn-download:hover {
            background: #218838;
        }

        .btn-copy {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .btn-copy:hover {
            background: #0056b3;
        }

        .btn-copy.copied {
            background: #28a745;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .section-title {
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-dark);
            margin: 20px 0 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .recommendation-box strong {
            color: #333;
            font-size: 16px;
        }

        .recommendation-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .recommendation-box li {
            margin: 5px 0;
            color: #555;
        }

        pre {
            background: #2d3748;
            color: #a0aec0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
            margin: 10px 0;
        }

        .prompt-box {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .small-note {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
        }

        hr {
            border: none;
            border-top: 2px solid #e0e0e0;
            margin: 30px 0;
        }

        .hidden {
            display: none;
        }

        #results {
            display: none;
        }

        #results.show {
            display: block;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                max-height: none;
            }

            .main-panel {
                max-height: none;
            }
        }

        .help-btn {
  display:inline-flex; align-items:center; justify-content:center;
  width:22px; height:22px; margin-left:8px; border:none; border-radius:50%;
   background: #e2e8f0;
  color: var(--primary-dark);
  box-shadow:0 1px 2px rgba(0,0,0,.06);
}
.help-btn:hover {background: #cbd5e1;}
.help-box {
  display:none; margin-top:8px; padding:12px; border-left:4px solid #667eea;
  background:#f8fafc; border-radius:8px; color:#334155; font-size:13px;
}
.help-box.show { display:block; }
.help-box b { color:#111827; }
.help-box .lesson { display:inline-block; margin-top:6px; font-weight:600; color:#4f46e5; }
.btn-hotmart {
  display:inline-flex; align-items:center; gap:10px;
  padding:14px 18px; border:0; border-radius:10px;
 background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
  box-shadow: 0 8px 18px rgba(30,41,59,0.35);
  color:#fff; font-weight:700; font-size:15px; cursor:pointer;
  transition: transform .15s ease, box-shadow .15s ease, filter .2s ease;
  text-decoration:none;
}
.btn-hotmart:hover { transform: translateY(-2px); filter: brightness(1.04); }
.btn-hotmart:active { transform: translateY(0); }
.btn-hotmart .icon { font-size:18px; }

.logo {
  display: block;
  margin: 0 auto 15px auto;
  width: 100px;
  height: auto;
  border-radius: 50%;
}
:root {
  --primary-dark: #1e293b; /* navy azulado */
  --primary-light: #3b82f6; /* azul m√©dio vibrante */
  --bg-light: #f1f5f9; /* azul clarinho */
  --text-dark: #1e293b;
}

    </style>
</head>
<body>
    <div class="container">
        <header>
        <img src="logo.png" alt="Logo Estat√≠stica com R" class="logo">
            <h1>üéØ Qual An√°lise Aplicar? ‚Äì Assistente Estat√≠stico</h1>
            <p>Sistema inteligente para recomenda√ß√£o de an√°lises e modelos estat√≠sticos</p>

<a class="btn-hotmart"
     href="https://hotmart.com/pt-br/club/estatistica-com-r"
     target="_blank" rel="noopener noreferrer">
    üéì  Acesse o para conhecer as aulas, m√≥dulos e materiais do curso.
  </a>




        </header>

        <div class="main-content">
            <div class="sidebar">
                <h4 style="margin-bottom: 20px; color: #667eea;">Preencha o diagn√≥stico</h4>

                <div class="form-group" data-help-for="objetivo">
                    <label> Objetivo principal</label>
                    <textarea id="objetivo" placeholder="Ex.: comparar 3 dietas; avaliar efeito do tempo e tratamento; dose‚Äìresposta..."></textarea>
                </div>

               <!-- <div class="form-group" data-help-for="descricao">
                    <label>1b) Descri√ß√£o do experimento (opcional)</label>
                    <textarea id="descricao" placeholder="Descreva seu experimento: unidades experimentais, tratamentos aplicados, como foi conduzido, etc."></textarea>
                </div>
-->
                <div class="form-group" data-help-for="ytype">
                    <label> Tipo da vari√°vel resposta</label>
                    <select id="ytype">
                        <option value="cont_norm">Cont√≠nua ~ normal</option>
                        <option value="cont_skew">Cont√≠nua assim√©trica (positiva)</option>
                        <option value="count">Contagem</option>
                        <option value="binary">Bin√°ria (0/1)</option>
                        <option value="prop">Propor√ß√£o (0‚Äì1)</option>
                        <option value="surv">Tempo at√© evento (sobreviv√™ncia)</option>
                        <option value="ordinal">Ordinal</option>
                    </select>
                </div>

                <div class="form-group" data-help-for="nfatores">
                    <label> N¬∫ de fatores (tratamentos)</label>
                    <input type="number" id="nfatores" value="1" min="1" step="1">
                </div>

                <div class="form-group" data-help-for="interacao">
                    <div class="checkbox-item">
                        <input type="checkbox" id="interacao">
                        <label for="interacao">H√° intera√ß√£o de interesse entre fatores?</label>
                    </div>
                </div>

                <div class="form-group" data-help-for="repmed">
                    <div class="checkbox-item">
                        <input type="checkbox" id="repmed">
                        <label for="repmed"> H√° medidas repetidas NO TEMPO (mesma unidade medida em v√°rios tempos)?</label>
                    </div>
                </div>

               <div class="form-group" data-help-for="design">
                    <label> Delineamento experimental</label>
                    <select id="design">
                        <option value="DIC">DIC (inteiramente casualizado)</option>
                        <option value="DBC">DBC (blocos)</option>
                        <option value="DQL">DQL (quadrado latino)</option>
                        <option value="Fatorial">Fatorial</option>
                        <option value="SplitPlot">Parcelas subdivididas (split-plot)</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>

                <div class="form-group" data-help-for="ranef">
                    <label> Efeitos aleat√≥rios previstos</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="ranef_bloco" value="bloco">
                            <label for="ranef_bloco">Bloco</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ranef_ind" value="ind">
                            <label for="ranef_ind">Indiv√≠duo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ranef_parcela" value="parcela">
                            <label for="ranef_parcela">Parcela</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ranef_outro" value="outro">
                            <label for="ranef_outro">Outro</label>
                        </div>
                    </div>
                </div>

                <div class="form-group" data-help-for="rep">
                    <label> Repeti√ß√µes por grupo/n√≠vel (aprox.)</label>
                    <input type="number" id="rep" value="3" min="1" step="1">
                </div>

                <div class="form-group" data-help-for="norm">
                    <label> Normalidade/Homoscedasticidade</label>
                    <select id="norm">
                        <option value="ok">Verificada e ok</option>
                        <option value="no">N√£o verificada</option>
                        <option value="incerto">Incerto</option>
                    </select>
                </div>

                <div class="form-group" data-help-for="relacao">
                    <label> Rela√ß√£o esperada</label>
                    <select id="relacao">
                        <option value="linear">Linear</option>
                        <option value="nlinear">N√£o linear (curva)</option>
                    </select>
                </div>

                <div id="count_options" class="hidden" data-help-for="count">
                    <div class="form-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="overdisp" checked>
                            <label for="overdisp">Contagem: suspeita de sobredispers√£o?</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="zeroinf">
                            <label for="zeroinf">Contagem: suspeita de excesso de zeros?</label>
                        </div>
                    </div>
                </div>

                <div id="prop_options" class="hidden" data-help-for="prop">
                    <div class="form-group">
                        <label>Propor√ß√£o</label>
                        <select id="prop_tipo">
                            <option value="binom">Sucesso/n conhecido (binomial com pesos)</option>
                            <option value="beta">Propor√ß√£o cont√≠nua em (0,1)</option>
                        </select>
                    </div>
                </div>

                <div id="surv_options" class="hidden" data-help-for="surv">
                    <div class="form-group">
                        <label>Sobreviv√™ncia: tipo de censura</label>
                        <select id="cens">
                            <option value="right">Direita</option>
                            <option value="left">Esquerda</option>
                            <option value="interval">Intervalar</option>
                            <option value="mixed">Mista/Incerta</option>
                        </select>
                    </div>
                </div>

                <button class="btn-primary" onclick="gerarRecomendacao()">Gerar Recomenda√ß√£o</button>
            </div>

            <div class="main-panel">
                <div id="results">
                    <h3 style="color: #667eea; margin-bottom: 20px;">Recomenda√ß√£o</h3>
                    <div id="recommendation"></div>

                    <hr>

                    <h3 style="color: #667eea; margin-bottom: 10px;">Prompt Final para a IA</h3>
                    <div class="small-note">
                        Este texto resume seu caso e pede √† IA a an√°lise/melhor modelo com f√≥rmula, c√≥digo R e diagn√≥sticos.
                    </div>
                    <div id="prompt_final" class="prompt-box"></div>
                    <div class="button-group">
                    <button class="btn-download" onclick="baixarPrompt()">üì• Baixar Prompt (.txt)</button>
                    <button id="btnCopy" class="btn-copy" onclick="copiarPrompt()">üìã Copiar texto</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mostrar/ocultar op√ß√µes condicionais
        document.getElementById('ytype').addEventListener('change', function() {
            const val = this.value;
            document.getElementById('count_options').classList.toggle('hidden', val !== 'count');
            document.getElementById('prop_options').classList.toggle('hidden', val !== 'prop');
            document.getElementById('surv_options').classList.toggle('hidden', val !== 'surv');
        });

        function getRandomEffects() {
            const ranefs = [];
            if (document.getElementById('ranef_bloco').checked) ranefs.push('bloco');
            if (document.getElementById('ranef_ind').checked) ranefs.push('ind');
            if (document.getElementById('ranef_parcela').checked) ranefs.push('parcela');
            if (document.getElementById('ranef_outro').checked) ranefs.push('outro');
            return ranefs;
        }

        function decideModel() {
            const ytype = document.getElementById('ytype').value;
            const nf = parseInt(document.getElementById('nfatores').value);
            const inter = document.getElementById('interacao').checked;
            const repmed = document.getElementById('repmed').checked;
            const design = document.getElementById('design').value;
            const ranef = getRandomEffects();
            const norm = document.getElementById('norm').value;
            const rel = document.getElementById('relacao').value;
            const overdisp = document.getElementById('overdisp').checked;
            const zeroinf = document.getElementById('zeroinf').checked;
            const prop_tipo = document.getElementById('prop_tipo').value;
            const cens = document.getElementById('cens').value;

            let analise = "‚Äî";
            let modelo = "‚Äî";
            let just = [];
            let formula = "‚Äî";
            let codigo = "";
            let sup = [];
            let alt = [];
            let vis = [];

            // Regras principais
            if (ytype === "surv") {
                analise = "An√°lise de Sobreviv√™ncia (Kaplan‚ÄìMeier + Cox)";
                modelo = "Modelo de Riscos Proporcionais de Cox";
                just.push("Resposta √© tempo at√© evento; comparar sobreviv√™ncia e estimar HR.");
                formula = "h(t|X) = h0(t) * exp(Œ≤1 X1 + Œ≤2 X2 + ...)";
                codigo = `library(survival); library(survminer)
fit_km <- survfit(Surv(tempo, status) ~ grupo, data=dat)
ggsurvplot(fit_km)
fit_cox <- coxph(Surv(tempo, status) ~ grupo + covariaveis, data=dat)
summary(fit_cox)`;
                sup.push("Proporcionalidade de riscos (teste de Schoenfeld).");
                alt.push("Se HR n√£o proporcional: estratificar ou usar Cox com efeitos de tempo (tv).");
                vis.push("Curvas Kaplan‚ÄìMeier e forest plot de HR.");
            } else if (rel === "nlinear") {
                if (!repmed && ranef.length === 0) {
                    analise = "Ajuste de Curva N√£o Linear (NLS)";
                    modelo = "Modelo N√£o Linear (ex.: Log√≠stico, Gompertz, Michaelis‚ÄìMenten)";
                    just.push("Rela√ß√£o esperada n√£o linear sem estrutura aleat√≥ria/hier√°rquica.");
                    formula = "y = f(x; Œ∏)  (ex.: y = Asym/(1 + exp(-(x - xmid)/scal)))";
                    codigo = `fit <- nls(y ~ SSlogis(x, Asym, xmid, scal), data=dat)
summary(fit)`;
                    sup.push("Especifica√ß√£o adequada da forma funcional; checar res√≠duos.");
                    alt.push("Se varia√ß√£o entre indiv√≠duos/parcela: usar NLME com efeitos aleat√≥rios.");
                    vis.push("Curva ajustada sobreposta aos dados; derivadas quando relevante.");
                } else {
                    analise = "Ajuste N√£o Linear com Efeitos Aleat√≥rios (NLME)";
                    modelo = "Modelo N√£o Linear Misto (NLME)";
                    just.push("Rela√ß√£o n√£o linear com heterogeneidade entre unidades (efeitos aleat√≥rios).");
                    formula = "y_ij = f(x_ij; Œ∏ + b_i) + Œµ_ij,  b_i ~ N(0, Œ£)";
                    codigo = `library(nlme)
fit <- nlme(y ~ Asym/(1+exp(-(x-xmid)/scal)),
            fixed = Asym + xmid + scal ~ 1,
            random = Asym ~ 1 | id,
            data = dat, start = c(Asym=..., xmid=..., scal=...))
summary(fit)`;
                    sup.push("Inicializa√ß√£o (start) coerente e converg√™ncia; estrutura de vari√¢ncia/correla√ß√£o.");
                    alt.push("Comparar formas funcionais por AIC/BIC; considerar transforma√ß√£o.");
                    vis.push("Curvas por indiv√≠duo/grupo e m√©dia do modelo.");
                }
            } else if (ytype === "cont_norm") {
                if (repmed || ranef.includes('ind') || ['DBC','DQL','SplitPlot'].includes(design)) {
                    analise = "Compara√ß√£o/efeitos com Medidas Repetidas ou Hierarquia";
                    modelo = "Modelo Misto Linear (LMM)";
                    just.push("Dados normais com efeitos aleat√≥rios (indiv√≠duo/bloco) e/ou repeti√ß√£o no tempo.");
                    just.push("Use lmer (lme4) para modelos mistos quando h√° efeitos aleat√≥rios.");
                    formula = "y = XŒ≤ + Zb + Œµ,  b ~ N(0, D), Œµ ~ N(0, R)";
                    codigo = `library(lme4); library(lmerTest)
fit <- lmer(y ~ fatores + (1|id) + (1|bloco), data=dat)
summary(fit); anova(fit)`;
                    sup.push("Normalidade/homoscedasticidade dos res√≠duos; ICC; estrutura de correla√ß√£o se necess√°rio (nlme::lme).");
                    alt.push("Se viola√ß√£o grave de normalidade: transformar y ou considerar GLMM apropriado (glmer/glmmTMB).");
                    vis.push("M√©dias ajustadas (emmeans) com IC; barras de erro; efeitos marginais.");
                } else {
                    if (nf === 1) {
                        analise = "Compara√ß√£o de m√©dias entre grupos";
                        modelo = "ANOVA One-Way (ou ANCOVA se houver covari√°vel)";
                        just.push("Resposta cont√≠nua ~ normal; grupos independentes; delineamento simples.");
                        formula = "y_ij = Œº + T_i + Œµ_ij";
                        codigo = `fit <- aov(y ~ grupo, data=dat)
summary(fit)
library(emmeans)
emmeans(fit, ~ grupo) |> pairs(adjust='tukey')`;
                        sup.push("Normalidade e vari√¢ncias homog√™neas; independ√™ncia.");
                        alt.push("Se normalidade falhar: Kruskal‚ÄìWallis + Dunn.");
                        vis.push("M√©dias com IC95% e letras de agrupamento.");
                    } else {
                        analise = "Efeitos principais e intera√ß√£o";
                        modelo = "ANOVA Fatorial";
                        just.push("Resposta cont√≠nua ~ normal; ‚â•2 fatores com poss√≠vel intera√ß√£o.");
                        formula = "y = Œº + A + B + A:B + Œµ";
                        codigo = `fit <- aov(y ~ A*B, data=dat)
summary(fit)
library(emmeans)
emmeans(fit, ~ A*B)`;
                        sup.push("Normalidade, homoscedasticidade e balan√ßo razo√°vel.");
                        alt.push("Se houver blocos relevantes: considerar LMM com (1|bloco).");
                        vis.push("Efeitos marginais e intera√ß√£o (plots de linhas com IC).");
                    }
                }
            } else if (ytype === "binary") {
                analise = "Resposta bin√°ria";
                if (repmed || ranef.length > 0) {
                    modelo = "GLMM Binomial (logit) com efeitos aleat√≥rios";
                    just.push("0/1 com hierarquia/repetidas; necessidade de componente aleat√≥rio.");
                    just.push("Use glmer (lme4) ou glmmTMB para modelos mistos generalizados com efeitos aleat√≥rios.");
                    formula = "logit(P(Y=1)) = XŒ≤ + Zb";
                    codigo = `library(lme4)
fit <- glmer(y ~ x + (1|id), family=binomial, data=dat)
# Ou com glmmTMB:
library(glmmTMB)
fit2 <- glmmTMB(y ~ x + (1|id), family=binomial, data=dat)
summary(fit)`;
                } else {
                    modelo = "GLM Binomial (logit)";
                    just.push("0/1 independentes sem estrutura aleat√≥ria.");
                    formula = "logit(P(Y=1)) = Œ≤0 + Œ≤1 X1 + ...";
                    codigo = `fit <- glm(y ~ x, family=binomial(link='logit'), data=dat)
summary(fit)`;
                }
                sup.push("Separa√ß√£o/quase-separa√ß√£o; influ√™ncia; pseudo-R¬≤.");
                alt.push("Se overfit: penaliza√ß√£o (ridge/firth).");
                vis.push("Probabilidades previstas por grupo/n√≠vel de x (IC).");
            } else if (ytype === "count") {
                analise = "Resposta de contagem";
                if (repmed || ranef.length > 0) {
                    if (overdisp || zeroinf) {
                        modelo = zeroinf ? "GLMM Binomial Negativa Zero-Inflada" : "GLMM Binomial Negativa";
                        just.push("Contagem com sobredispers√£o/excesso de zeros e estrutura aleat√≥ria.");
                        just.push("Use glmer.nb (lme4) ou glmmTMB para modelos mistos generalizados com efeitos aleat√≥rios.");
                        formula = "log(E[Y]) = XŒ≤ + Zb   (+ componente zero-inflado)";
                        codigo = zeroinf ?
`library(glmmTMB)
fit <- glmmTMB(y ~ x + (1|id), ziformula=~1, family=nbinom2, data=dat)
summary(fit)` :
`library(lme4)
fit <- glmer.nb(y ~ x + (1|id), data=dat)
# Ou com glmmTMB:
library(glmmTMB)
fit2 <- glmmTMB(y ~ x + (1|id), family=nbinom2, data=dat)
summary(fit)`;
                    } else {
                        modelo = "GLMM Poisson";
                        just.push("Contagem com vari√¢ncia ~ m√©dia e efeitos aleat√≥rios.");
                        just.push("Use glmer (lme4) para modelos mistos generalizados Poisson com efeitos aleat√≥rios.");
                        formula = "log(E[Y]) = XŒ≤ + Zb";
                        codigo = `library(lme4)
fit <- glmer(y ~ x + (1|id), family=poisson, data=dat)
summary(fit)`;
                    }
                } else {
                    if (overdisp || zeroinf) {
                        modelo = zeroinf ? "GLM Binomial Negativa Zero-Inflada" : "GLM Binomial Negativa";
                        just.push("Contagem com sobredispers√£o/excesso de zeros.");
                        formula = "log(E[Y]) = Œ≤0 + Œ≤1 X1 + ...";
                        codigo = zeroinf ?
`library(glmmTMB)
fit <- glmmTMB(y ~ x, ziformula=~1, family=nbinom2, data=dat)
summary(fit)` :
`library(MASS)
fit <- glm.nb(y ~ x, data=dat)
summary(fit)`;
                    } else {
                        modelo = "GLM Poisson";
                        just.push("Contagem aproximadamente Poisson sem sobredispers√£o.");
                        formula = "log(E[Y]) = Œ≤0 + Œ≤1 X1 + ...";
                        codigo = `fit <- glm(y ~ x, family=poisson, data=dat)
dispersiontest::dispersiontest(fit)`;
                    }
                }
                sup.push("Checar sobredispers√£o; res√≠duos; influ√™ncia.");
                alt.push("Se sobredispers√£o: migrar para NegBin; se zeros: zero-inflado/hurdle.");
                vis.push("Taxas previstas por grupo/n√≠vel (IC).");
            } else if (ytype === "prop") {
                analise = "Resposta proporcional";
                if (prop_tipo === "binom") {
                    if (repmed || ranef.length > 0) {
                        modelo = "GLMM Binomial com pesos (sucessos/n)";
                        just.push("Propor√ß√£o com denominador conhecido e hierarquia.");
                        formula = "logit(p) = XŒ≤ + Zb;  cbind(sucesso, n - sucesso)";
                        codigo = `library(glmmTMB)
fit <- glmmTMB(cbind(sucesso, n - sucesso) ~ x + (1|id), family=binomial, data=dat)
summary(fit)`;
                    } else {
                        modelo = "GLM Binomial com pesos (sucessos/n)";
                        just.push("Propor√ß√£o com n conhecido e observa√ß√µes independentes.");
                        formula = "logit(p) = Œ≤0 + Œ≤1 X1 + ... ;  cbind(sucesso, n - sucesso)";
                        codigo = `fit <- glm(cbind(sucesso, n - sucesso) ~ x, family=binomial, data=dat)
summary(fit)`;
                    }
                } else {
                    if (repmed || ranef.length > 0) {
                        modelo = "GLMM Beta";
                        just.push("Propor√ß√£o cont√≠nua em (0,1) com efeitos aleat√≥rios.");
                        formula = "g(Œº) = XŒ≤ + Zb,  Y ~ Beta(Œº, œÜ)";
                        codigo = `library(glmmTMB)
fit <- glmmTMB(y ~ x + (1|id), family=beta_family(), data=dat)
summary(fit)`;
                    } else {
                        modelo = "Beta Regression";
                        just.push("Propor√ß√£o cont√≠nua (0,1) independente.");
                        formula = "g(Œº) = Œ≤0 + Œ≤1 X1 + ... ,  Y ~ Beta(Œº, œÜ)";
                        codigo = `library(betareg)
fit <- betareg::betareg(y ~ x, data=dat)
summary(fit)`;
                    }
                }
                sup.push("Transformar valores 0/1 puros (ajuste para (0,1)); checar res√≠duos.");
                alt.push("Quasi-binomial como alternativa robusta; GLMM se hierarquia forte.");
                vis.push("Probabilidades m√©dias e IC por grupo/n√≠vel de x.");
            } else if (ytype === "cont_skew") {
                analise = "Resposta cont√≠nua assim√©trica";
                if (repmed || ranef.length > 0) {
                    modelo = "LMM ap√≥s transforma√ß√£o (log) ou GLMM Gamma";
                    just.push("Assimetria + estrutura aleat√≥ria; considerar link apropriado.");
                    formula = "log(y) = XŒ≤ + Zb + Œµ  (ou)  g(Œº) = XŒ≤ + Zb, Y ~ Gamma";
                    codigo = `# Op√ß√£o 1: transformar
library(lme4); fit <- lmer(log(y) ~ x + (1|id), data=dat)
# Op√ß√£o 2: GLMM Gamma
library(glmmTMB); fit2 <- glmmTMB(y ~ x + (1|id), family=Gamma(link='log'), data=dat)
summary(fit); summary(fit2)`;
                } else {
                    modelo = "GLM Gamma (link log) ou LM em log(y)";
                    just.push("Assimetria positiva; vari√¢ncia crescente com m√©dia.");
                    formula = "log(Œº) = Œ≤0 + Œ≤1 X1 + ... ,  Y ~ Gamma";
                    codigo = `# Op√ß√£o 1: GLM Gamma
fit <- glm(y ~ x, family=Gamma(link='log'), data=dat)
# Op√ß√£o 2: LM em log(y)
fit2 <- lm(log(y) ~ x, data=dat)`;
                }
                sup.push("Ader√™ncia do link; res√≠duos; influ√™ncia.");
                alt.push("gamlss (flex√≠vel) ou transforma√ß√£o Box‚ÄìCox.");
                vis.push("M√©dias previstas no espa√ßo original (back-transform).");
            } else if (ytype === "ordinal") {
                analise = "Resposta ordinal";
                modelo = "Modelo Logit Proporcional (ordinal)";
                just.push("Categorias ordenadas (ex.: leve, moderado, grave).");
                formula = "logit[P(Y ‚â§ k)] = Œ∏_k ‚àí XŒ≤";
                codigo = `library(MASS)
fit <- MASS::polr(ordinal ~ x, data=dat, Hess=TRUE)
summary(fit)`;
                sup.push("Suposi√ß√£o de odds proporcionais; teste de Brant (VGAM).");
                alt.push("Modelos parciais de odds proporcionais (VGAM).");
                vis.push("Probabilidades por categoria e efeitos marginais.");
            }

            return {
                analise: analise,
                modelo: modelo,
                just: just,
                formula: formula,
                codigo: codigo,
                sup: sup,
                alt: alt,
                vis: vis
            };
        }

        function buildPrompt(rec) {
            const objetivo = document.getElementById('objetivo').value || "‚Äî";
            const descricao = document.getElementById('descricao').value || "‚Äî";
            const ytype = document.getElementById('ytype').value;
            const nf = document.getElementById('nfatores').value;
            const inter = document.getElementById('interacao').checked;
            const repmed = document.getElementById('repmed').checked;
            const design = document.getElementById('design').value;
            const ranef = getRandomEffects();
            const rep = document.getElementById('rep').value;
            const norm = document.getElementById('norm').value;
            const rel = document.getElementById('relacao').value;
            const overdisp = document.getElementById('overdisp').checked;
            const zeroinf = document.getElementById('zeroinf').checked;
            const prop_tipo = document.getElementById('prop_tipo').value;
            const cens = document.getElementById('cens').value;

            let lines = [
                "Voc√™ √© um consultor estat√≠stico. Com base nas informa√ß√µes abaixo, recomende a an√°lise e o MELHOR MODELO estat√≠stico (com justificativa curta), forne√ßa a f√≥rmula do modelo, c√≥digo R m√≠nimo (pacotes), diagn√≥sticos e alternativa se suposi√ß√µes falharem.",
                "",
                "--- CONTEXTO DO MEU PROBLEMA ---",
                `Objetivo: ${objetivo}`,
            ];

            if (descricao !== "‚Äî") {
                lines.push(`Descri√ß√£o do experimento: ${descricao}`);
            }

            lines.push(
                `Tipo da resposta: ${ytype}`,
                `N¬∫ de fatores: ${nf}${inter ? " (com intera√ß√£o de interesse)" : ""}`,
                `Medidas repetidas NO TEMPO: ${repmed ? "Sim" : "N√£o"}`,
                `Delineamento: ${design}`,
                `Efeitos aleat√≥rios previstos: ${ranef.length === 0 ? "Nenhum" : ranef.join(", ")}`,
            );

            // Adicionar orienta√ß√£o sobre modelos mistos
            if (ranef.length > 0 || repmed) {
                lines.push("");
                lines.push("‚ö†Ô∏è IMPORTANTE: Como h√° efeitos aleat√≥rios ou medidas repetidas:");
                if (ytype === "cont_norm" && norm === "ok") {
                    lines.push("- Use MODELO MISTO LINEAR com lmer (pacote lme4) para dados normais");
                } else if (ytype !== "cont_norm" || norm !== "ok") {
                    lines.push("- Use MODELO MISTO GENERALIZADO com glmer (lme4) ou glmmTMB para dados n√£o normais");
                }
                lines.push("");
            }

            lines.push(
                `Repeti√ß√µes por grupo (aprox.): ${rep}`,
                `Normalidade/homoscedasticidade: ${norm}`,
                `Rela√ß√£o esperada: ${rel}`
            );

            if (ytype === "count") {
                lines.push(`Contagem ‚Äì Sobredispers√£o: ${overdisp} | Excesso de zeros: ${zeroinf}`);
            }
            if (ytype === "prop") {
                lines.push(`Propor√ß√£o ‚Äì Tipo: ${prop_tipo}`);
            }
            if (ytype === "surv") {
                lines.push(`Sobreviv√™ncia ‚Äì Censura: ${cens}`);
            }

            lines.push("");
            lines.push("--- O QUE EU PRECISO COMO RESPOSTA ---");
            lines.push("1) Nome da an√°lise recomendada (1 linha).");
            lines.push("2) Melhor modelo estat√≠stico (com justificativa curta).");
            lines.push("3) F√≥rmula do modelo (nota√ß√£o).");
            lines.push("4) Descri√ß√£o do delineamento/experimento e pap√©is de efeitos fixos/aleat√≥rios.");
            lines.push("5) C√≥digo R m√≠nimo reprodut√≠vel (pacotes e fun√ß√µes).");
            lines.push("6) Suposi√ß√µes e como diagnosticar (passo a passo).");
            lines.push("7) Alternativas se suposi√ß√µes falharem.");
            lines.push("8) Visualiza√ß√£o recomendada (camadas ggplot/emmeans).");
            lines.push("");
            lines.push("--- SUGEST√ÉO INICIAL AUTOM√ÅTICA (pode confirmar ou ajustar) ---");
            lines.push(`An√°lise sugerida: ${rec.analise}`);
            lines.push(`Melhor modelo: ${rec.modelo}`);
            lines.push("Justificativa curta:");
            if (rec.just.length > 0) {
                rec.just.forEach(j => lines.push(`‚Ä¢ ${j}`));
            } else {
                lines.push("‚Ä¢ ‚Äî");
            }
            lines.push(`F√≥rmula: ${rec.formula}`);
            lines.push("Pacotes/c√≥digo base:");
            lines.push(rec.codigo);
            lines.push("Suposi√ß√µes/checar:");
            if (rec.sup.length > 0) {
                rec.sup.forEach(s => lines.push(`‚Ä¢ ${s}`));
            } else {
                lines.push("‚Ä¢ ‚Äî");
            }
            lines.push("Alternativas:");
            if (rec.alt.length > 0) {
                rec.alt.forEach(a => lines.push(`‚Ä¢ ${a}`));
            } else {
                lines.push("‚Ä¢ ‚Äî");
            }
            lines.push("Visualiza√ß√£o:");
            if (rec.vis.length > 0) {
                rec.vis.forEach(v => lines.push(`‚Ä¢ ${v}`));
            } else {
                lines.push("‚Ä¢ ‚Äî");
            }

            return lines.join("\n");
        }

        function gerarRecomendacao() {
            const rec = decideModel();

            // Montar HTML da recomenda√ß√£o
            let html = `
                <div class="recommendation-box">
                    <div class="section-title">üîç An√°lise Recomendada:</div>
                    <p><strong>${rec.analise}</strong></p>
                </div>

                <div class="recommendation-box">
                    <div class="section-title">üéØ Melhor Modelo Estat√≠stico:</div>
                    <p><strong>${rec.modelo}</strong></p>
                </div>

                <div class="recommendation-box">
                    <div class="section-title">üìò Justificativa curta:</div>
                    <ul>
                        ${rec.just.map(j => `<li>${j}</li>`).join('')}
                    </ul>
                </div>

                <div class="recommendation-box">
                    <div class="section-title">‚àë F√≥rmula (nota√ß√£o):</div>
                    <pre>${rec.formula}</pre>
                </div>

                <div class="recommendation-box">
                    <div class="section-title">üîß R ‚Äì C√≥digo m√≠nimo:</div>
                    <pre>${rec.codigo}</pre>
                </div>

                <div class="recommendation-box">
                    <div class="section-title">‚úÖ Suposi√ß√µes/checagens:</div>
                    <ul>
                        ${rec.sup.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>

                <div class="recommendation-box">
                    <div class="section-title">üîÑ Alternativas:</div>
                    <ul>
                        ${rec.alt.map(a => `<li>${a}</li>`).join('')}
                    </ul>
                </div>

                <div class="recommendation-box">
                    <div class="section-title">üìä Visualiza√ß√£o recomendada:</div>
                    <ul>
                        ${rec.vis.map(v => `<li>${v}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('recommendation').innerHTML = html;
            document.getElementById('prompt_final').textContent = buildPrompt(rec);
            document.getElementById('results').classList.add('show');

            // Scroll suave para os resultados
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function baixarPrompt() {
            const rec = decideModel();
            const text = buildPrompt(rec);
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prompt_analise_estatistica.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

    function copiarPrompt() {
    const el = document.getElementById('prompt_final');
    const text = (el?.textContent || el?.innerText || '').trim();
    const btn = document.getElementById('btnCopy');
    if (!text) {
      feedbackCopy(btn, false, '‚ö†Ô∏è Sem texto');
      return;
    }

    // Prefer√™ncia: API moderna (requer contexto seguro ‚Äî https:)
    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(text)
        .then(() => feedbackCopy(btn, true))
        .catch(() => fallbackCopy(text, btn));
    } else {
      // Fallback para http/ambientes n√£o seguros
      fallbackCopy(text, btn);
    }
  }

  function fallbackCopy(text, btn) {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.setAttribute('readonly', '');
    ta.style.position = 'fixed';
    ta.style.top = '-1000px';
    document.body.appendChild(ta);
    ta.select();
    ta.setSelectionRange(0, ta.value.length);
    try {
      const ok = document.execCommand('copy');
      feedbackCopy(btn, ok);
    } catch (e) {
      feedbackCopy(btn, false);
    }
    document.body.removeChild(ta);
  }

  function feedbackCopy(btn, ok, altMsg) {
    const original = btn.textContent;
    btn.classList.toggle('copied', ok);
    btn.textContent = ok ? '‚úÖ Copiado!' : (altMsg || '‚ö†Ô∏è N√£o copiado');
    btn.disabled = true;
    setTimeout(() => {
      btn.classList.remove('copied');
      btn.textContent = original;
      btn.disabled = false;
    }, 1500);
  }



  /* ===== 3.1. Textos de ajuda + mapeamento das aulas ===== */
const HELP_TEXT = {
  objetivo: {
    html: `
      <b>O que escrever?</b> Descreva em 1‚Äì2 linhas qual pergunta cient√≠fica voc√™ quer responder (comparar dietas, efeito do tempo, dose‚Äìresposta etc.).<br>
      <span class="lesson">Assista: Aula 1 ‚Äî Estat√≠stica Descritiva (enquadrar objetivos) + Aula 3 ‚Äî ANOVA (compara√ß√µes) + Aula 6 ‚Äî Regress√£o (associa√ß√£o)</span>
    `
  },
  descricao: {
    html: `
      <b>Descri√ß√£o do experimento</b> Diga a unidade experimental, como os tratamentos foram aplicados, se houve blocos/parcelas, e como foram coletadas as medidas.<br>
      <span class="lesson">Assista: Aula 4 ‚Äî Delineamentos Experimentais</span>
    `
  },
  ytype: {
    html: `
      <b>Tipo da vari√°vel resposta</b> Escolha o formato dos dados que voc√™ mede: cont√≠nua normal/assim√©trica, contagem, bin√°ria, propor√ß√£o, tempo at√© evento, ordinal.<br>
      <span class="lesson">Assista: Aula 2 ‚Äî Normalidade; Aula 9 ‚Äî GLM; Aula 10 ‚Äî N√£o Param√©tricos; Aula 11 ‚Äî Sobreviv√™ncia</span>
    `
  },
  nfatores: {
    html: `
      <b>N¬∫ de fatores</b> Quantos fatores (tratamentos) seus dados t√™m? (ex.: dieta, tempo, dose).<br>
      <span class="lesson">Assista: Aula 3 ‚Äî ANOVA (fatorial)</span>
    `
  },
  interacao: {
    html: `
      <b>Intera√ß√£o</b> Intera√ß√£o ocorre quando o efeito de um fator depende do n√≠vel de outro (ex.: dieta √ó tempo).<br>
      <span class="lesson">Assista: Aula 3 ‚Äî ANOVA (efeitos principais √ó intera√ß√£o)</span>
    `
  },
  repmed: {
    html: `
      <b>Medidas repetidas</b> A mesma unidade foi medida no tempo? Isso requer estrutura de correla√ß√£o/efeitos aleat√≥rios.<br>
      <span class="lesson">Assista: Aula 8 ‚Äî Modelos Mistos</span>
    `
  },
  design: {
    html: `
      <b>Delineamento</b> DIC, DBC, DQL, Fatorial, Split-plot. O delineamento impacta o modelo e os erros apropriados.<br>
      <span class="lesson">Assista: Aula 4 ‚Äî Delineamentos Experimentais</span>
    `
  },
  ranef: {
    html: `
      <b>Efeitos aleat√≥rios</b> Bloco, indiv√≠duo, parcela‚Ä¶ Capturam varia√ß√£o n√£o explicada e correla√ß√£o intra-unidade.<br>
      <span class="lesson">Assista: Aula 8 ‚Äî Modelos Mistos</span>
    `
  },
  rep: {
    html: `
      <b>Repeti√ß√µes</b> Quantas unidades por grupo/n√≠vel. Afeta poder estat√≠stico e precis√£o das estimativas.<br>
      <span class="lesson">Assista: Aula 7 ‚Äî Power Analysis</span>
    `
  },
  norm: {
    html: `
      <b>Normalidade/homoscedasticidade</b> Requisitos para testes/modelos param√©tricos. Teste e avalie res√≠duos e QQ-plot.<br>
      <span class="lesson">Assista: Aula 2 ‚Äî Testes de Normalidade</span>
    `
  },
  relacao: {
    html: `
      <b>Rela√ß√£o esperada</b> Linear vs. n√£o linear (curvas). Isso define LM/GLM vs. NLS/NLME.<br>
      <span class="lesson">Assista: Aula 6 ‚Äî Regress√£o Linear; Aula 12 ‚Äî Modelos N√£o Lineares</span>
    `
  },
  count: {
    html: `
      <b>Contagem</b> Verifique sobredispers√£o (vari√¢ncia >> m√©dia) e excesso de zeros para escolher Poisson vs. Binomial Negativa (zero-inflado).<br>
      <span class="lesson">Assista: Aula 9 ‚Äî GLM (Poisson, Binomial Negativa)</span>
    `
  },
  prop: {
    html: `
      <b>Propor√ß√£o</b> Sucessos/n (binomial com pesos) vs. propor√ß√£o cont√≠nua em (0,1) (beta regression).<br>
      <span class="lesson">Assista: Aula 9 ‚Äî GLM (Binomial, Beta)</span>
    `
  },
  surv: {
    html: `
      <b>Sobreviv√™ncia</b> Tipo de censura (direita, esquerda, intervalar) determina a formula√ß√£o e diagn√≥sticos (PH).<br>
      <span class="lesson">Assista: Aula 11 ‚Äî An√°lise de Sobreviv√™ncia</span>
    `
  }
};

/* ===== 3.2. Injeta o bot√£o ‚Äú?‚Äù e a caixa de ajuda em cada .form-group[data-help-for] ===== */
function setupHelp() {
  document.querySelectorAll('.form-group[data-help-for], #count_options[data-help-for], #prop_options[data-help-for], #surv_options[data-help-for]')
    .forEach(group => {
      const key = group.getAttribute('data-help-for');
      const help = HELP_TEXT[key];
      if (!help) return;

      // acha o primeiro <label> dentro do grupo (ou cria um wrapper)
      const label = group.querySelector('label') || group.firstElementChild;
      if (!label) return;

      // bot√£o ?
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'help-btn';
      btn.textContent = '?';

      // caixa
      const box = document.createElement('div');
      box.className = 'help-box';
      box.innerHTML = help.html;

      btn.addEventListener('click', () => box.classList.toggle('show'));

      // injeta
      label.appendChild(btn);
      label.insertAdjacentElement('afterend', box);
    });
}

/* ===== 3.3. Lista din√¢mica de aulas relevantes para exibir na Recomenda√ß√£o ===== */
function aulasRelevantes() {
  const out = new Set();
  const ytype = document.getElementById('ytype').value;
  const nf = +document.getElementById('nfatores').value || 1;
  const inter = document.getElementById('interacao').checked;
  const repmed = document.getElementById('repmed').checked;
  const design = document.getElementById('design').value;
  const ranef = (document.getElementById('ranef_bloco').checked ||
                 document.getElementById('ranef_ind').checked ||
                 document.getElementById('ranef_parcela').checked ||
                 document.getElementById('ranef_outro').checked);
  const norm = document.getElementById('norm').value;
  const rel = document.getElementById('relacao').value;
  const overdisp = document.getElementById('overdisp')?.checked;
  const zeroinf = document.getElementById('zeroinf')?.checked;
  const prop_tipo = document.getElementById('prop_tipo')?.value;

  // sempre √∫teis
  out.add('Aula 1 ‚Äî Estat√≠stica Descritiva');
  if (norm !== 'ok') out.add('Aula 2 ‚Äî Testes de Normalidade');

  if (design !== 'Outro') out.add('Aula 4 ‚Äî Delineamentos Experimentais');
  if (nf >= 1) out.add('Aula 3 ‚Äî ANOVA');

  if (repmed || ranef) out.add('Aula 8 ‚Äî Modelos Mistos');

  if (rel === 'linear') out.add('Aula 6 ‚Äî Regress√£o Linear');
  if (rel === 'nlinear') out.add('Aula 12 ‚Äî Modelos N√£o Lineares');

  if (ytype === 'count' || ytype === 'binary' || ytype === 'prop' || ytype === 'cont_skew')
    out.add('Aula 9 ‚Äî GLM');

  if (ytype === 'prop') out.add('Aula 9 ‚Äî GLM (Binomial/Beta)');
  if (ytype === 'count' && (overdisp || zeroinf)) out.add('Aula 9 ‚Äî GLM (NegBin/Zero-Inflado)');

  if (ytype === 'ordinal') out.add('Aula 9 ‚Äî GLM (Ordinal)');
  if (ytype === 'surv') out.add('Aula 11 ‚Äî Sobreviv√™ncia');

  out.add('Aula 7 ‚Äî Power Analysis');

  return Array.from(out);
}

/* ===== 3.4. Acrescenta ‚Äúüìö Onde estudar no curso‚Äù na Recomenda√ß√£o ===== */
const _oldGerar = gerarRecomendacao;
gerarRecomendacao = function() {
  _oldGerar(); // roda sua l√≥gica original

  const aulas = aulasRelevantes();
  const sec = document.createElement('div');
  sec.className = 'recommendation-box';
  sec.innerHTML = `
    <div class="section-title">üìö Onde estudar no curso</div>
    <ul>${aulas.map(a => `<li>${a}</li>`).join('')}</ul>
  `;
  document.getElementById('recommendation').appendChild(sec);
}

/* ===== 3.5. Insere lembrete de normalidade dentro da PROMPT quando "N√£o verificada" ===== */
const _oldBuild = buildPrompt;
buildPrompt = function(rec) {
  let txt = _oldBuild(rec);
  const norm = document.getElementById('norm').value;
  const aulas = aulasRelevantes();

  // Lembrete expl√≠cito se normalidade n√£o foi verificada
  if (norm === 'no') {
    txt += `

‚ö†Ô∏è Observa√ß√£o importante:
Antes de decidir o modelo final, assista a **Aula 2 ‚Äî Testes de Normalidade** para avaliar normalidade/homoscedasticidade e ajustar conforme necess√°rio.`;
  }

  // Informa que o aluno tem acesso √†s aulas relevantes
  txt += `

üìö Tenho acesso √†s seguintes aulas que cobrem este caso:
- ${aulas.join('\n- ')}`;

  return txt;
}

/* ===== 3.6. Inicializa quando a p√°gina carregar ===== */
document.addEventListener('DOMContentLoaded', setupHelp);
//setupHelp(); // caso o script carregue ap√≥s DOM
const FIELDS = ['objetivo','descricao','ytype','nfatores','interacao','repmed','design','ranef_bloco','ranef_ind','ranef_parcela','ranef_outro','rep','norm','relacao','overdisp','zeroinf','prop_tipo','cens'];

function saveState() {
  const state = {};
  FIELDS.forEach(id => {
    const el = $(id);
    if (!el) return;
    state[id] = el.type === 'checkbox' ? el.checked : el.value;
  });
  localStorage.setItem('assistente-estatistico', JSON.stringify(state));
}

function loadState() {
  const raw = localStorage.getItem('assistente-estatistico');
  if (!raw) return;
  const state = JSON.parse(raw);
  FIELDS.forEach(id => {
    const el = $(id);
    if (!el || state[id] === undefined) return;
    if (el.type === 'checkbox') el.checked = state[id];
    else el.value = state[id];
  });
  // garantir visibilidade dos blocos condicionais
  const evt = new Event('change');
  $('ytype')?.dispatchEvent(evt);
}

document.addEventListener('input', (e) => {
  if (e.target && FIELDS.includes(e.target.id)) saveState();
});
document.addEventListener('DOMContentLoaded', loadState);
    </script>
</body>
</html>
